{"version":3,"sources":["main.js"],"names":["appPackage","require","logger","nconf","testData","env","argv","file","defaults","port","hilbert_cli_path","test","scriptConcurrency","max_log_length","log_directory","log_level","mkls_poll_delay","mkls_cmd","long_poll_timeout","add","transports","File","filename","get","level","handleExceptions","json","process","on","err","error","message","exitCode","info","version","hilbertCLIConnector","mkLivestatusConnector","testBackend","simulateDelays","load","getHilbertCLIConnector","getMKLivestatusConnector","stationManager","init","then","server","listen","catch","exit"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAaC,QAAQ,iBAAR,CAAnB;AACA,IAAMC,SAASD,QAAQ,SAAR,CAAf;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;;AAEA,IAAMG,WAAWH,QAAQ,sCAAR,CAAjB;;AAEAE,MAAME,GAAN,GAAYC,IAAZ;AACAH,MAAMI,IAAN,CAAW,aAAX;AACAJ,MAAMK,QAAN,CAAe;AACbC,QAAM,MADO;AAEbC,oBAAkB,iBAFL;AAGbC,QAAM,KAHO;AAIbC,qBAAmB,EAJN;AAKbC,kBAAgB,GALH;AAMbC,iBAAe,OANF;AAObC,aAAW,MAPE,EAOM;AACnBC,mBAAiB,IARJ;AASbC,YAAU,mBATG;AAUbC,qBAAmB;AAVN,CAAf;;AAaAhB,OAAOiB,GAAP,CAAWjB,OAAOkB,UAAP,CAAkBC,IAA7B,EAAmC;AACjCC,YAAanB,MAAMoB,GAAN,CAAU,eAAV,CAAb,oBADiC;AAEjCC,SAAOrB,MAAMoB,GAAN,CAAU,WAAV,CAF0B;AAGjCE,oBAAkB,IAHe;AAIjCC,QAAM;AAJ2B,CAAnC;;AAOAxB,OAAOsB,KAAP,GAAerB,MAAMoB,GAAN,CAAU,WAAV,CAAf;;AAEAI,QAAQC,EAAR,CAAW,mBAAX,EAAgC,UAACC,GAAD,EAAS;AACvC3B,SAAO4B,KAAP,0BAAoCD,IAAIE,OAAxC;AACAJ,UAAQK,QAAR,GAAmB,CAAnB;AACD,CAHD;;AAKA9B,OAAO+B,IAAP,mCAA4CjC,WAAWkC,OAAvD;;AAEA,IAAIC,sBAAsB,IAA1B;AACA,IAAIC,wBAAwB,IAA5B;;AAEA,IAAIjC,MAAMoB,GAAN,CAAU,MAAV,CAAJ,EAAuB;AACrBrB,SAAO+B,IAAP,CAAY,sBAAZ;AACA,MAAMI,cAAc,0BAAgBlC,KAAhB,EAAuBD,MAAvB,CAApB;AACAmC,cAAYC,cAAZ,GAA6B,IAA7B;AACAD,cAAYE,IAAZ,CAAiBnC,QAAjB;AACA+B,wBAAsBE,YAAYG,sBAAZ,EAAtB;AACAJ,0BAAwBC,YAAYI,wBAAZ,EAAxB;AACD,CAPD,MAOO;AACLN,wBAAsB,kCAAwBhC,KAAxB,EAA+BD,MAA/B,CAAtB;AACAkC,0BAAwB,oCAA0BjC,KAA1B,EAAiCD,MAAjC,CAAxB;AACD;;AAED,IAAMwC,iBAAiB,6BACrBvC,KADqB,EAErBD,MAFqB,EAGrBiC,mBAHqB,EAIrBC,qBAJqB,CAAvB;;AAOAM,eAAeC,IAAf,GAAsBC,IAAtB,CAA2B,YAAM;AAC/B,MAAMC,SAAS,4BAAkBH,cAAlB,EAAkCvC,KAAlC,EAAyCD,MAAzC,CAAf;AACA2C,SAAOC,MAAP,CAAc3C,MAAMoB,GAAN,CAAU,MAAV,CAAd;AACD,CAHD,EAGGwB,KAHH,CAGS,UAAClB,GAAD,EAAS;AAChB3B,SAAO4B,KAAP,0CAAoDD,IAAIE,OAAxD;AACAJ,UAAQqB,IAAR,CAAa,CAAb;AACD,CAND","file":"main.js","sourcesContent":["import 'babel-polyfill';\nimport StationManager from './lib/station-manager';\nimport HilbertCLIConnector from './lib/hilbert-cli-connector';\nimport MKLivestatusConnector from './lib/mk-livestatus-connector';\nimport HttpAPIServer from './lib/http-api-server';\nimport TestBackend from './lib/test-backend';\n\nconst appPackage = require('../package.json');\nconst logger = require('winston');\nconst nconf = require('nconf');\n\nconst testData = require('../data/test_mode/test_stations.json');\n\nnconf.env().argv();\nnconf.file('config.json');\nnconf.defaults({\n  port: '3000',\n  hilbert_cli_path: '../work/dockapp',\n  test: false,\n  scriptConcurrency: 20,\n  max_log_length: 100,\n  log_directory: './log',\n  log_level: 'info', // error, warn, info, verbose, debug, silly\n  mkls_poll_delay: 1000,\n  mkls_cmd: 'nc localhost 6557',\n  long_poll_timeout: 15,\n});\n\nlogger.add(logger.transports.File, {\n  filename: `${nconf.get('log_directory')}/hilbert-ui.log`,\n  level: nconf.get('log_level'),\n  handleExceptions: true,\n  json: false,\n});\n\nlogger.level = nconf.get('log_level');\n\nprocess.on('uncaughtException', (err) => {\n  logger.error(`Uncaught exception: ${err.message}. Exiting process.`);\n  process.exitCode = 1;\n});\n\nlogger.info(`Starting hilbert-ui server (v${appPackage.version})`);\n\nlet hilbertCLIConnector = null;\nlet mkLivestatusConnector = null;\n\nif (nconf.get('test')) {\n  logger.info('Running in Test Mode');\n  const testBackend = new TestBackend(nconf, logger);\n  testBackend.simulateDelays = true;\n  testBackend.load(testData);\n  hilbertCLIConnector = testBackend.getHilbertCLIConnector();\n  mkLivestatusConnector = testBackend.getMKLivestatusConnector();\n} else {\n  hilbertCLIConnector = new HilbertCLIConnector(nconf, logger);\n  mkLivestatusConnector = new MKLivestatusConnector(nconf, logger);\n}\n\nconst stationManager = new StationManager(\n  nconf,\n  logger,\n  hilbertCLIConnector,\n  mkLivestatusConnector\n);\n\nstationManager.init().then(() => {\n  const server = new HttpAPIServer(stationManager, nconf, logger);\n  server.listen(nconf.get('port'));\n}).catch((err) => {\n  logger.error(`Error initializing Station Manager: ${err.message}. Exiting process.`);\n  process.exit(1);\n});\n"],"sourceRoot":"/source/"}